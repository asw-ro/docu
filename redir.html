<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Documentatii ASiSerp</title>
    <meta name="description" content="Redirectionare documentatii ASiSerp" />
    <meta name="viewport" content="width=device-width,initial-scale=1,shrink-to-fit=no" />

    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="article" />
    <meta property="og:title" content="DocumentaÈ›ie ASiSerp" />
    <meta property="og:description" content="Vizualizare documentaÈ›ie ASiSerp" />
    <meta property="og:image" content="https://docu.asiserp.ro/assets/thumbnail.png" />
    <meta property="og:url" content="https://docu.asiserp.ro/redir.html" />

    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta name="twitter:title" content="DocumentaÈ›ie ASiSerp" />
    <meta name="twitter:description" content="Vizualizare documentaÈ›ie ASiSerp" />
    <meta name="twitter:image" content="https://docu.asiserp.ro/assets/thumbnail.png" />

    <!-- Favicon light bulb -->
    <link
      rel="icon"
      type="image/svg+xml"
      href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24'%3E%3Cpath fill='%23fdd835' d='M9 21h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1v-1Zm3-19a7 7 0 0 1 4.86 11.95c-.54.53-.86 1.24-.86 2v.55a1 1 0 0 1-.62.92c-.73.29-1.38.73-1.87 1.27a1 1 0 0 1-1.42 0 5 5 0 0 0-1.87-1.27a1 1 0 0 1-.62-.92V16c0-.75-.32-1.47-.88-2A7 7 0 0 1 12 2Z'/%3E%3C/path%3E%3C/svg%3E"
    />
    <link rel="icon" sizes="32x32" href="/assets/favicon-96x96.png" />
    <link rel="apple-touch-icon" sizes="180x180" href="/assets/apple-touch-icon.png" />
    <link rel="manifest" href="/assets/site.webmanifest" />
    <link rel="stylesheet" href="style.css" />
    <script src="google-doc-loader.js"></script>
    <style>
      .spinner-container {
        margin-top: 5rem;
        text-align: center;
      }

      .spinner {
        margin: 0 auto 20px;
        width: 50px;
        height: 50px;
        border: 6px solid #ccc;
        border-top: 6px solid #3498db;
        border-radius: 50%;
        animation: spin 1s linear infinite;
      }

      @keyframes spin {
        0% {
          transform: rotate(0deg);
        }
        100% {
          transform: rotate(360deg);
        }
      }

      .message {
        font-size: 1.2rem;
        color: #333;
      }
    </style>
  </head>
  <body style="margin: 0; max-width: initial">
    <div id="backBar" class="doc-view-bar">
      <a href="/" class="doc-back-btn"><span style="font-size: 1.05rem">âŸµ</span><span>ÃŽnapoi</span></a>
      <div class="doc-title-wrapper">
        <div id="docTitle" class="doc-title-chip">
          <span class="doc-title-dot" aria-hidden="true"></span>
          <span class="doc-title-text">Se incarcÄƒ...</span>
        </div>
      </div>
      <button id="copyUrlBtn" class="doc-back-btn" style="cursor: pointer; border: 1px solid #90caf9">
        <span style="font-size: 1.05rem">ðŸ“‹</span>
        <span>CopiazÄƒ URL</span>
      </button>
    </div>
    <div class="spinner-container">
      <div class="spinner"></div>
      <div class="message">Se Ã®ncarcÄƒ conÈ›inutul...</div>
    </div>
    <!-- Content will be populated by google-doc-loader.js using the ?document_id=... query string -->
    <script>
      // Get the document ID from URL
      const urlParams = new URLSearchParams(window.location.search);
      const documentId = urlParams.get("document_id");
      let shortUrl = null;

      // Fetch the API to find the short URL for this document
      if (documentId) {
        fetch("https://asis.asw.ro/asisservice/linkuri?codlink=docu&reponsetype=json")
          .then(r => r.json())
          .then(data => {
            // Find the entry that matches this document_id
            const match = data.find(item => {
              if (item.urlcomplet && item.urlcomplet.includes(documentId)) {
                return true;
              }
              return false;
            });

            if (match && match.numescurt) {
              // Build the short URL
              shortUrl = window.location.origin + "/" + match.numescurt;
            }
          })
          .catch(err => {
            console.error("Failed to fetch short URL mapping:", err);
          });
      }

      // Copy URL functionality - copies the short URL if available, otherwise the current URL
      document.getElementById("copyUrlBtn").addEventListener("click", function () {
        const urlToCopy = shortUrl || window.location.href;
        navigator.clipboard
          .writeText(urlToCopy)
          .then(() => {
            const btn = this;
            const originalText = btn.querySelector("span:last-child").textContent;
            btn.querySelector("span:last-child").textContent = "âœ“ Copiat!";
            btn.style.background = "#c8e6c9";
            btn.style.borderColor = "#81c784";

            setTimeout(() => {
              btn.querySelector("span:last-child").textContent = originalText;
              btn.style.background = "";
              btn.style.borderColor = "";
            }, 2000);
          })
          .catch(err => {
            console.error("Failed to copy:", err);
            alert("Nu s-a putut copia URL-ul");
          });
      });
    </script>
  </body>
</html>
